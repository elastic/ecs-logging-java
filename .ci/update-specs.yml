---
name: update specs

scms:
  githubConfig:
    kind: github
    spec:
      user: '{{ requiredEnv "GIT_USER" }}'
      email: '{{ requiredEnv "GIT_EMAIL" }}'
      owner: elastic
      repository: ecs-logging-java
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      username: '{{ requiredEnv "GIT_USER" }}'
      branch: main

actions:
  ecs-logging-java:
    kind: github/pullrequest
    scmid: githubConfig
    sourceid: sha
    spec:
      automerge: false
      labels:
        - dependencies
      title: 'synchronize ecs-logging spec'
      description: |-
        ### What

        ECS logging specs automatic sync

        ### Why

        *Changeset*
        * https://github.com/elastic/ecs-logging/commit/{{ source "sha" }}

sources:
  spec.json:
    name: Get specs from json
    kind: file
    spec:
      file: https://raw.githubusercontent.com/elastic/ecs-logging/main/spec/spec.json

  sha:
    name: Get commit
    kind: json
    spec:
      file: 'https://api.github.com/repos/elastic/ecs-logging/commits?path=spec%2Fspec.json&page=1&per_page=1'
      key: ".[0].sha"

targets:
  spec.json-update:
    name: 'synchronize ecs-logging spec'
    kind: file
    sourceid: spec.json
    scmid: githubConfig
    spec:
      file: ecs-logging-core/src/test/resources/spec/spec.json
